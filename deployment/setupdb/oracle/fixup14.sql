-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- IBM Docs Source Materials                                         
--                                                                   
-- (c) Copyright IBM Corporation 2012. All Rights Reserved.          
--                                                                   
-- U.S. Government Users Restricted Rights: Use, duplication or      
-- disclosure restricted by GSA ADP Schedule Contract with IBM Corp. 
--                                                                   
-- ***************************************************************** 

--CONNECT TO CONCORD@
ALTER SESSION SET CURRENT_SCHEMA = CONCORDDB;

CREATE TABLE "CONCORDDB"."TASK" (
	"TASK_ID" VARCHAR2(256)  NOT NULL , 
	"URI" VARCHAR2(2048)  NOT NULL  ,
	"REPO_ID" VARCHAR2(256)  NOT NULL  ,
	"AUTHOR" VARCHAR2(256)  NOT NULL , 
	"TASKSTATE" VARCHAR2(256)  NOT NULL , 
	"CREATEDATE" TIMESTAMP  NOT NULL , 
	"DUEDATE" TIMESTAMP  NOT NULL , 
	"LASTMODIFY" TIMESTAMP  NOT NULL , 
	"ASSOCIATION_ID" VARCHAR2(256)  NOT NULL ,	
	"TASKTITLE" VARCHAR2(256) , 	
	"ASSIGNEE" VARCHAR2(256) , 
	"REVIEWER" VARCHAR2(256) , 
	"TASKCONTENT" VARCHAR2(2048) , 
	"VERSION_ID" VARCHAR2(256) , 
	"FRAGMENT_ID" VARCHAR2(256),
	"CHANGESET" VARCHAR2(256))
TABLESPACE "DOCSTS32";

	
ALTER TABLE "CONCORDDB"."TASK" ADD PRIMARY KEY ("TASK_ID");

CREATE TABLE "CONCORDDB"."TASKHISTORY" (
	"HISTORY_ID" VARCHAR2(256)  NOT NULL , 
	"TASK_ID" VARCHAR2(256)  NOT NULL , 	
	"CREATOR" VARCHAR2(256)  NOT NULL , 
	"CHANGESET" VARCHAR2(2048)  NOT NULL , 
	"ACTIONTYPE" VARCHAR2(256)  NOT NULL , 
	"ACTIONTIMESTAMP" TIMESTAMP  NOT NULL
)
TABLESPACE "DOCSTS32";

ALTER TABLE "CONCORDDB"."TASKHISTORY" ADD PRIMARY KEY ("HISTORY_ID");

CREATE TABLE "CONCORDDB"."ASSOCIATEDWITH" (
	"ASSOCIATION_ID" VARCHAR2(256)  NOT NULL , 
	"ASSOCIATION_TYPE" VARCHAR2(256)  NOT NULL  ,	
	"LABEL" VARCHAR2(2048)  NOT NULL ,	
	"ASSOCIATIONCONTENT" VARCHAR2(2048) , 
	"ASSOCIATION_TAG" VARCHAR2(256) , 
	"CHANGESET" VARCHAR2(256)
)
TABLESPACE "DOCSTS32";

ALTER TABLE "CONCORDDB"."ASSOCIATEDWITH" ADD PRIMARY KEY ("ASSOCIATION_ID");
	
CREATE TABLE "CONCORDDB"."MESSAGE" (
	"URI" VARCHAR2(2048)  NOT NULL  ,
	"REPO_ID" VARCHAR2(256)  NOT NULL  ,			
	"USER_ID" VARCHAR2(2048)  NOT NULL ,
	"MESSAGE_TYPE" VARCHAR2(256)  NOT NULL , 
	"BYTESMESSAGE" VARCHAR2(4000)  NOT NULL  ,
	"MSGTIMESTAMP" TIMESTAMP  NOT NULL  ,			
	"EXPIRATION" TIMESTAMP  NOT NULL ,	
	"DUEDATE" TIMESTAMP  NOT NULL ,	 	
	"CHANGESET" VARCHAR2(256)
)
TABLESPACE "DOCSTS32";

ALTER TABLE "CONCORDDB"."MESSAGE" ADD PRIMARY KEY ("URI","REPO_ID","USER_ID","MESSAGE_TYPE");

CREATE  INDEX CONCORDDB.INDEX_TASKHISOTY_TASKID ON CONCORDDB.TASKHISTORY ("TASK_ID" ASC);  
CREATE  INDEX CONCORDDB.INDEX_TASK_ASSOCIATION_ID ON CONCORDDB.TASK ("ASSOCIATION_ID" ASC);  
CREATE  INDEX CONCORDDB.INDEX_TASK_URI ON CONCORDDB.TASK ("URI" ASC);
CREATE  INDEX CONCORDDB.INDEX_TASK_REPO_ID ON CONCORDDB.TASK ("REPO_ID" ASC);
CREATE  INDEX CONCORDDB.INDEX_TASK_ASSIGNEE ON CONCORDDB.TASK ("ASSIGNEE" ASC); 
CREATE  INDEX CONCORDDB.INDEX_TASK_REVIEWER ON CONCORDDB.TASK ("REVIEWER" ASC);
CREATE  INDEX CONCORDDB.INDEX_TASK_TASKSTATE  ON CONCORDDB.TASK ("TASKSTATE" ASC);
CREATE  INDEX CONCORDDB.INDEX_MESSAGE_EXPIRATION  ON CONCORDDB.MESSAGE ("EXPIRATION" ASC); 

ALTER TABLE CONCORDDB.TASK ADD CONSTRAINT CONSTRAINT_TASK 
	FOREIGN KEY (ASSOCIATION_ID) 
	REFERENCES CONCORDDB.ASSOCIATEDWITH (ASSOCIATION_ID)  
	ON DELETE CASCADE;
--	ON UPDATE NO ACTION ENFORCED  ENABLE QUERY OPTIMIZATION;

ALTER TABLE CONCORDDB.TASKHISTORY  ADD CONSTRAINT CONSTRAINT_TASKHIS FOREIGN KEY (TASK_ID) 
	REFERENCES CONCORDDB.TASK (TASK_ID)  
	ON DELETE CASCADE; 
--	ON UPDATE NO ACTION ENFORCED  ENABLE QUERY OPTIMIZATION;
  
COMMIT;
QUIT;
