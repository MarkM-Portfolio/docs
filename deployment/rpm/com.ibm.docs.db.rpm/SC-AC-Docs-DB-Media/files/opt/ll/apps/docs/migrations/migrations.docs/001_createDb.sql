-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- IBM Docs Source Materials                                         
--                                                                   
-- (c) Copyright IBM Corporation 2012. All Rights Reserved.          
--                                                                   
-- U.S. Government Users Restricted Rights: Use, duplication or      
-- disclosure restricted by GSA ADP Schedule Contract with IBM Corp. 
--                                                                   
-- ***************************************************************** 


--------------------------------------
-- CREATE THE DATABASE
-------------------------------------- 
 

-- CREATE BUFFERPOOL HOMEPAGE4KBP IMMEDIATE SIZE 4000 AUTOMATIC PAGESIZE 4K;
-- CREATE BUFFERPOOL NT8KBP IMMEDIATE SIZE 8000 AUTOMATIC PAGESIZE 8K;
-- CREATE BUFFERPOOL NEWS16KBP IMMEDIATE SIZE 16000 AUTOMATIC PAGESIZE 16K;

-- Disable the run stats. Increase the logs
-- UPDATE DATABASE CONFIGURATION USING AUTO_RUNSTATS OFF IMMEDIATE;
-- UPDATE DATABASE CONFIGURATION USING LOGPRIMARY 26;
-- UPDATE DATABASE CONFIGURATION USING LOGSECOND 52;
-- UPDATE DBM CFG USING NUMDB 10;

-- HOMEPAGE TABLESPACE
-- CREATE LARGE TABLESPACE HOMEPAGETABSPACE  
-- 	PAGESIZE 4K MANAGED BY DATABASE
-- 	USING (FILE 'HOMEPAGETABSPACE' 20000) 
-- 	EXTENTSIZE 4
-- 	PREFETCHSIZE AUTOMATIC
-- 	BUFFERPOOL HOMEPAGE4KBP
-- 	AUTORESIZE YES
-- 	INCREASESIZE 20 M
-- 	MAXSIZE NONE;
--  
-- HOMEPAGE NOTIFICATION TABLETABLESPACE
-- CREATE SYSTEM TEMPORARY TABLESPACE HPNTTMPTABSPACE
-- 	PAGESIZE 8K MANAGED BY SYSTEM 
-- 	USING ( 'HPNTTMPTABSPACE' ) 
-- 	EXTENTSIZE 8 PREFETCHSIZE AUTOMATIC
-- 	BUFFERPOOL NT8KBP
-- 	FILE SYSTEM CACHING;
--               
-- CREATE LARGE TABLESPACE HPNTTABSPACE 
-- 	PAGESIZE 8K MANAGED BY DATABASE
-- 	USING (FILE 'HPNTTABSPACE' 12800)
-- 	EXTENTSIZE 8
-- 	PREFETCHSIZE AUTOMATIC
-- 	BUFFERPOOL NT8KBP
-- 	AUTORESIZE YES
-- 	INCREASESIZE 20 M
-- 	MAXSIZE NONE;
-- 
-- HOMEPAGE NEWS TABLETABLESPACE
-- CREATE SYSTEM TEMPORARY TABLESPACE NEWSTMPTABSPACE
-- 	PAGESIZE 16K MANAGED BY SYSTEM 
-- 	USING ( 'NEWSTMPTABSPACE' ) 
-- 	EXTENTSIZE 16 PREFETCHSIZE AUTOMATIC
-- 	BUFFERPOOL NEWS16KBP
-- 	FILE SYSTEM CACHING;
	      
-- CREATE LARGE TABLESPACE NEWSTABSPACE 
-- 	PAGESIZE 16K MANAGED BY DATABASE
-- 	USING (FILE 'NEWSTABSPACE' 12800)
-- 	EXTENTSIZE 16
-- 	PREFETCHSIZE AUTOMATIC
-- 	BUFFERPOOL NEWS16KBP
-- 	AUTORESIZE YES
-- 	INCREASESIZE 40 M
-- 	MAXSIZE NONE;              
    
--------------------------------------
-- CREATE THE SCHEMA
--------------------------------------    
        

--CREATE DATABASE CONCORD USING CODESET UTF-8 TERRITORY US;
--	CONNECT TO CONCORD;
--	CREATE SCHEMA CONCORDDB;
--	CONNECT RESET;



--CONNECT TO CONCORD;
--CREATE BUFFERPOOL "CONCORDBUFFER"  SIZE 250 PAGESIZE 32768;
--CONNECT RESET;

--CONNECT TO CONCORD;
--CREATE  LARGE  TABLESPACE "CONCORDNAMESPACE" PAGESIZE 32 K  MANAGED BY AUTOMATIC STORAGE EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14 BUFFERPOOL  CONCORDBUFFER ;
--CONNECT RESET;

------------------------------------
-- TABLESPACES --
------------------------------------
--CONNECT TO CONCORD;
--CREATE LARGE TABLESPACE "SYSTOOLSPACE" IN DATABASE PARTITION GROUP IBMCATGROUP 
--	 PAGESIZE 4096 MANAGED BY AUTOMATIC STORAGE 
--	 AUTORESIZE YES 
--	 INITIALSIZE 32 M 
--	 MAXSIZE NONE 
--	 EXTENTSIZE 4
--	 PREFETCHSIZE AUTOMATIC
--	 BUFFERPOOL IBMDEFAULTBP
--	 OVERHEAD 7.500000
--	 TRANSFERRATE 0.060000 
--	 NO FILE SYSTEM CACHING  
--	 DROPPED TABLE RECOVERY ON;


--CREATE USER TEMPORARY TABLESPACE "SYSTOOLSTMPSPACE" IN DATABASE PARTITION GROUP IBMCATGROUP 
--	 PAGESIZE 4096 MANAGED BY AUTOMATIC STORAGE 
--	 EXTENTSIZE 4
--	 PREFETCHSIZE AUTOMATIC
--	 BUFFERPOOL IBMDEFAULTBP
--	 OVERHEAD 7.500000
--	 TRANSFERRATE 0.060000 
--	 FILE SYSTEM CACHING  
--	 DROPPED TABLE RECOVERY OFF;


-- 

--ALTER TABLESPACE SYSCATSPACE
--      PREFETCHSIZE AUTOMATIC
--      OVERHEAD 7.500000
--      NO FILE SYSTEM CACHING 
--      AUTORESIZE YES 
--      TRANSFERRATE 0.060000;


--ALTER TABLESPACE TEMPSPACE1
--      PREFETCHSIZE AUTOMATIC
--      OVERHEAD 7.500000
--      FILE SYSTEM CACHING 
--      TRANSFERRATE 0.060000;


--ALTER TABLESPACE USERSPACE1
--      PREFETCHSIZE AUTOMATIC
--      OVERHEAD 7.500000
--      NO FILE SYSTEM CACHING 
--      AUTORESIZE YES 
--      TRANSFERRATE 0.060000;


-- userpreference			
CREATE TABLE "CONCORDDB"."USERPREFERENCE"  (
		  "ID" VARCHAR(2048) NOT NULL , 
		  "ORGID" VARCHAR(256),
		  "PREFERENCE" BLOB(4096) LOGGED NOT COMPACT ,
		  PRIMARY KEY("ID"))   
		 IN "CONCORDNAMESPACE" ;

CREATE TABLE "CONCORDDB"."DOCEDITORS" (
	"REPOID" VARCHAR(2048) NOT NULL,
	"DOCID" VARCHAR(2048) NOT NULL,
	"USERID" VARCHAR(2048) NOT NULL,
	"ORGID" VARCHAR(2048) NOT NULL,
	"DISPLAYNAME" VARCHAR(2048),
	"COLOR" VARCHAR(64)
) IN "CONCORDNAMESPACE" ;

CREATE TABLE "CONCORDDB"."DOC_ACTIVITY" (
	"REPO_ID" VARCHAR(256) NOT NULL,
	"URI" VARCHAR(256) NOT NULL,
	"ACTIVITY_ID" VARCHAR(256) NOT NULL,
	"ORGID" VARCHAR(256) NOT NULL,
	"CREATEDBY" VARCHAR(256) NOT NULL,
	"CREATIONDATE" TIMESTAMP,
	PRIMARY KEY("REPO_ID", "URI"))
	IN "CONCORDNAMESPACE" ;

--repo_id(string) uri(string) org_id (string), user_id (string) activity_id(string) creationdate (string)
CREATE TABLE "CONCORDDB"."DOC_REFERENCE" (
	"PARENT_REPO" VARCHAR(256) NOT NULL,
	"PARENT_URI" VARCHAR(256) NOT NULL,
	"CHILD_REPO" VARCHAR(256) NOT NULL,
	"CHILD_URI" VARCHAR(256) NOT NULL,
	"ORGID" VARCHAR(256),
	"CREATEDBY" VARCHAR(256),
	"CREATIONDATE" TIMESTAMP,
	PRIMARY KEY("PARENT_REPO", "PARENT_URI", "CHILD_REPO", "CHILD_URI"))
	IN "CONCORDNAMESPACE" ;
--parent_repo (string) parent_uri (string) child_repo (string) child_uri (string) org_id(string) user_id (string) creationdate (timestamp)
-- clipboard			
CREATE TABLE "CONCORDDB"."CLIPBOARD"  (
		  "ID" VARCHAR(2048) NOT NULL , 
		  "USERID" VARCHAR (2048)  NOT NULL ,
		  "ORGID" VARCHAR(256),
		  "USEREMAIL" VARCHAR (1024) ,
		  "TAG" VARCHAR (1024) ,
		  "PROVIDERS" VARCHAR (2048) ,
		  "CLIPDATA" VARCHAR (20480) ,
		  "LASTMODIFICATIONDATE" TIMESTAMP ,
		  PRIMARY KEY("ID"))   
		 IN "CONCORDNAMESPACE" ;
			


CREATE TABLE "CONCORDDB"."PRODUCT"
(
	"ID" VARCHAR(128) NOT NULL,
	"VERSION_MAJOR" SMALLINT DEFAULT 0 NOT NULL,
	"VERSION_MINOR" SMALLINT DEFAULT 0 NOT NULL,
	"VERSION_MILLI" SMALLINT DEFAULT 0 NOT NULL,
	"VERSION_MICRO" SMALLINT DEFAULT 0 NOT NULL,
	"SCHEMA_VERSION" VARCHAR(32) NOT NULL,
	PRIMARY KEY("ID")
)
IN "CONCORDNAMESPACE";

INSERT INTO "CONCORDDB"."PRODUCT"
	("ID","VERSION_MAJOR","VERSION_MINOR","VERSION_MILLI","VERSION_MICRO","SCHEMA_VERSION")
	VALUES ('lotuslive.symphony',1,0,0,0,'1');

ALTER TABLE "CONCORDDB"."CLIPBOARD" DROP COLUMN USEREMAIL;

REORG TABLE "CONCORDDB"."CLIPBOARD";

ALTER TABLE CONCORDDB.USERPREFERENCE DROP PRIMARY KEY ;
ALTER TABLE CONCORDDB.USERPREFERENCE DROP COLUMN "ID" ;
ALTER TABLE CONCORDDB.USERPREFERENCE ADD COLUMN "USER_ID" VARCHAR (256) NOT NULL WITH DEFAULT '' ;
ALTER TABLE CONCORDDB.USERPREFERENCE ADD COLUMN "PROP_KEY" VARCHAR(256) NOT NULL WITH DEFAULT '' ;
ALTER TABLE CONCORDDB.USERPREFERENCE ADD COLUMN "PROP_VALUE"  VARCHAR(1024) ;
REORG TABLE "CONCORDDB"."USERPREFERENCE" ;
ALTER TABLE CONCORDDB.USERPREFERENCE ADD CONSTRAINT "USERPREFERENCE_PK" PRIMARY KEY ( USER_ID, PROP_KEY)  ;
REORG TABLE "CONCORDDB"."USERPREFERENCE" ;

ALTER TABLE "CONCORDDB"."DOC_REFERENCE" ADD COLUMN "TASK_ID" VARCHAR (256) ;
ALTER TABLE "CONCORDDB"."DOC_REFERENCE" ADD COLUMN "SUBMIT_TIME" TIMESTAMP ;
ALTER TABLE "CONCORDDB"."DOC_REFERENCE" ADD COLUMN "CANCEL_TIME" TIMESTAMP ;
REORG TABLE "CONCORDDB"."DOC_REFERENCE" ;
------------------------------------------------------------------------------------------
-- Create House Keeping Scheduler Tables and Indexes --
-- Assuming that the "Table Prefix" defined in WAS admin console must be "CONCORDDB.HK". --
------------------------------------------------------------------------------------------


CREATE TABLE "CONCORDDB"."HKTASK" ("TASKID" BIGINT NOT NULL ,
              "VERSION" VARCHAR(5) NOT NULL ,
              "ROW_VERSION" INTEGER NOT NULL ,
              "TASKTYPE" INTEGER NOT NULL ,
              "TASKSUSPENDED" SMALLINT NOT NULL ,
              "CANCELLED" SMALLINT NOT NULL ,
              "NEXTFIRETIME" BIGINT NOT NULL ,
              "STARTBYINTERVAL" VARCHAR(254) ,
              "STARTBYTIME" BIGINT ,
              "VALIDFROMTIME" BIGINT ,
              "VALIDTOTIME" BIGINT ,
              "REPEATINTERVAL" VARCHAR(254) ,
              "MAXREPEATS" INTEGER NOT NULL ,
              "REPEATSLEFT" INTEGER NOT NULL ,
              "TASKINFO" BLOB(102400) LOGGED NOT COMPACT ,
              "NAME" VARCHAR(254) NOT NULL ,
              "AUTOPURGE" INTEGER NOT NULL ,
              "FAILUREACTION" INTEGER ,
              "MAXATTEMPTS" INTEGER ,
              "QOS" INTEGER ,
              "PARTITIONID" INTEGER ,
              "OWNERTOKEN" VARCHAR(200) NOT NULL ,
              "CREATETIME" BIGINT NOT NULL )  IN "CONCORDNAMESPACE" ;

ALTER TABLE "CONCORDDB"."HKTASK" ADD PRIMARY KEY ("TASKID");

CREATE INDEX "CONCORDDB"."HKTASK_IDX1" ON "CONCORDDB"."HKTASK" ("TASKID",
              "OWNERTOKEN") ;

CREATE INDEX "CONCORDDB"."HKTASK_IDX2" ON "CONCORDDB"."HKTASK" ("NEXTFIRETIME" ASC,
               "REPEATSLEFT",
               "PARTITIONID") CLUSTER;

CREATE TABLE "CONCORDDB"."HKTREG" ("REGKEY" VARCHAR(254) NOT NULL ,
              "REGVALUE" VARCHAR(254) ) IN "CONCORDNAMESPACE" ;

ALTER TABLE "CONCORDDB"."HKTREG" ADD PRIMARY KEY ("REGKEY");

CREATE TABLE "CONCORDDB"."HKLMGR" (LEASENAME VARCHAR(254) NOT NULL,
               LEASEOWNER VARCHAR(254) NOT NULL,
               LEASE_EXPIRE_TIME  BIGINT,
              DISABLED VARCHAR(5))IN "CONCORDNAMESPACE" ;

ALTER TABLE "CONCORDDB"."HKLMGR" ADD PRIMARY KEY ("LEASENAME");

CREATE TABLE "CONCORDDB"."HKLMPR" (LEASENAME VARCHAR(254) NOT NULL,
              NAME VARCHAR(254) NOT NULL,
              VALUE VARCHAR(254) NOT NULL)IN "CONCORDNAMESPACE" ;

CREATE INDEX "CONCORDDB"."HKLMPR_IDX1" ON "CONCORDDB"."HKLMPR" (LEASENAME,
               NAME);

CREATE  SYSTEM TEMPORARY  TABLESPACE TEMPSPACEPK PAGESIZE 32 K  MANAGED BY AUTOMATIC STORAGE EXTENTSIZE 16 OVERHEAD 10.5 PREFETCHSIZE 16 TRANSFERRATE 0.14 BUFFERPOOL  CONCORDBUFFER ;

ALTER TABLE CONCORDDB.DOCEDITORS ADD CONSTRAINT DOCEDITORS_PK PRIMARY KEY ( REPOID, DOCID, USERID) ;

CREATE TABLE "CONCORDDB"."DOC_HISTORY"  (
		  "REPO_ID" VARCHAR(256) NOT NULL ,
		  "URI" VARCHAR(2048) NOT NULL ,
		  "LAST_MODIFIED" VARCHAR(256) ,
		  "ORG_ID" VARCHAR(256) ,
		  PRIMARY KEY("REPO_ID", "URI"))   
		 IN "CONCORDNAMESPACE" ;

CREATE TABLE "CONCORDDB"."SUBSCRIBER"
(
	"ID" VARCHAR(128) NOT NULL,
	"CUSTOMER_ID" VARCHAR(128) NOT NULL,
	"TYPE" SMALLINT NOT NULL,
	"DISPLAY_NAME" VARCHAR(128),
	"EMAIL" VARCHAR(128),
	"STATE" VARCHAR(32) NOT NULL,
	"ENTITLEMENT" VARCHAR(32) NOT NULL,
	PRIMARY KEY("ID", "TYPE")
)	IN "CONCORDNAMESPACE";


ALTER TABLE "CONCORDDB"."SUBSCRIBER" ALTER COLUMN "EMAIL" SET DATA TYPE VARCHAR(255);
ALTER TABLE "CONCORDDB"."SUBSCRIBER" ADD COLUMN "LOCALE" VARCHAR(32) ;

REORG TABLE "CONCORDDB"."SUBSCRIBER";

CREATE TABLE "CONCORDDB"."DOCUMENTSESSION"
(
	"REPOID" VARCHAR(256) NOT NULL,
	"DOCID" VARCHAR(256) NOT NULL,
	"SERVINGSERVER" VARCHAR(2048) NOT NULL,
	PRIMARY KEY("REPOID", "DOCID")
)	IN "CONCORDNAMESPACE";

ALTER TABLE CONCORDDB.DOCUMENTSESSION ADD COLUMN STATUS SMALLINT  NOT NULL  WITH DEFAULT 0 ;

COMMIT WORK;
CONNECT RESET;


--DISCONNECT ALL;
