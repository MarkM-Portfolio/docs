-- ***************************************************************** 
--                                                                   
-- IBM Confidential                                                  
--                                                                   
-- IBM Docs Source Materials                                         
--                                                                   
-- (c) Copyright IBM Corporation 2012. All Rights Reserved.          
--                                                                   
-- U.S. Government Users Restricted Rights: Use, duplication or      
-- disclosure restricted by GSA ADP Schedule Contract with IBM Corp. 
--                                                                   
-- ***************************************************************** 

CREATE TABLE "CONCORDDB"."TASK" (
	"TASK_ID" VARCHAR (256)  NOT NULL , 
	"URI" VARCHAR (2048)  NOT NULL  ,
	"REPO_ID" VARCHAR (256)  NOT NULL  ,
	"AUTHOR" VARCHAR (256)  NOT NULL , 
	"TASKSTATE" VARCHAR (256)  NOT NULL , 
	"CREATEDATE" TIMESTAMP  NOT NULL , 
	"DUEDATE" TIMESTAMP  NOT NULL , 
	"LASTMODIFY" TIMESTAMP  NOT NULL , 
	"ASSOCIATION_ID" VARCHAR (256)  NOT NULL ,	
	"TASKTITLE" VARCHAR (256) , 	
	"ASSIGNEE" VARCHAR (256) , 
	"REVIEWER" VARCHAR (256) , 
	"TASKCONTENT" VARCHAR (2048) , 
	"VERSION_ID" VARCHAR (256) , 
	"FRAGMENT_ID" VARCHAR (256),
	"CHANGESET" VARCHAR (256) ,
 	PRIMARY KEY("TASK_ID"))
	IN "CONCORDNAMESPACE" ;	

CREATE TABLE "CONCORDDB"."TASKHISTORY" (
	"HISTORY_ID" VARCHAR (256)  NOT NULL , 
	"TASK_ID" VARCHAR (256)  NOT NULL , 	
	"CREATOR" VARCHAR (256)  NOT NULL , 
	"CHANGESET" VARCHAR (2048)  NOT NULL , 
	"ACTIONTYPE" VARCHAR (256)  NOT NULL , 
	"ACTIONTIMESTAMP" TIMESTAMP  NOT NULL   ,
 	PRIMARY KEY("HISTORY_ID"))
	IN "CONCORDNAMESPACE" ;		

CREATE TABLE "CONCORDDB"."ASSOCIATEDWITH" (
	"ASSOCIATION_ID" VARCHAR (256)  NOT NULL , 
	"ASSOCIATION_TYPE" VARCHAR (256)  NOT NULL  ,	
	"LABEL" VARCHAR (2048)  NOT NULL ,	
	"ASSOCIATIONCONTENT" VARCHAR (2048) , 
	"ASSOCIATION_TAG" VARCHAR (256) , 
	"CHANGESET" VARCHAR (256) ,
 	PRIMARY KEY("ASSOCIATION_ID"))
	IN "CONCORDNAMESPACE" ;	

CREATE TABLE "CONCORDDB"."MESSAGE" (
	"URI" VARCHAR (2048)  NOT NULL  ,
	"REPO_ID" VARCHAR (256)  NOT NULL  ,			
	"USER_ID" VARCHAR (2048)  NOT NULL ,
	"MESSAGE_TYPE" VARCHAR (256)  NOT NULL , 
	"BYTESMESSAGE" VARCHAR (10240)  NOT NULL  ,
	"MSGTIMESTAMP" TIMESTAMP  NOT NULL  ,			
	"EXPIRATION" TIMESTAMP  NOT NULL ,	
	"DUEDATE" TIMESTAMP  NOT NULL ,	 	
	"CHANGESET" VARCHAR (256) , 
 	PRIMARY KEY("URI","REPO_ID","USER_ID","MESSAGE_TYPE"))
	IN "CONCORDNAMESPACE" ;	

CREATE  INDEX CONCORDDB.INDEX_TASKHISOTY_TASKID ON CONCORDDB.TASKHISTORY (TASK_ID);  
CREATE  INDEX CONCORDDB.INDEX_TASK_ASSOCIATION_ID ON CONCORDDB.TASK (ASSOCIATION_ID);  
CREATE  INDEX CONCORDDB.INDEX_TASK_URI ON CONCORDDB.TASK (URI); 
CREATE  INDEX CONCORDDB.INDEX_TASK_REPO_ID ON CONCORDDB.TASK (REPO_ID); 
CREATE  INDEX CONCORDDB.INDEX_TASK_ASSIGNEE ON CONCORDDB.TASK (ASSIGNEE); 
CREATE  INDEX CONCORDDB.INDEX_TASK_REVIEWER ON CONCORDDB.TASK (REVIEWER); 
CREATE  INDEX CONCORDDB.INDEX_TASK_TASKSTATE  ON CONCORDDB.TASK (TASKSTATE); 
CREATE  INDEX CONCORDDB.INDEX_MESSAGE_EXPIRATION  ON CONCORDDB.MESSAGE (EXPIRATION); 

ALTER TABLE CONCORDDB.TASK ADD CONSTRAINT CONSTRAINT_TASK FOREIGN KEY (ASSOCIATION_ID) REFERENCES CONCORDDB.ASSOCIATEDWITH (ASSOCIATION_ID)  ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED  ENABLE QUERY OPTIMIZATION ;

ALTER TABLE CONCORDDB.TASKHISTORY  ADD CONSTRAINT CONSTRAINT_TASKHIS FOREIGN KEY (TASK_ID) REFERENCES CONCORDDB.TASK (TASK_ID)  ON DELETE CASCADE ON UPDATE NO ACTION ENFORCED  ENABLE QUERY OPTIMIZATION ;

COMMIT WORK;
CONNECT RESET;


--DISCONNECT ALL;
